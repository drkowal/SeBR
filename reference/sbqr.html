<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Semiparametric Bayesian quantile regression — sbqr • SeBR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Semiparametric Bayesian quantile regression — sbqr"><meta name="description" content="MCMC sampling for Bayesian quantile regression with an
unknown (nonparametric) transformation. Like in traditional Bayesian
quantile regression, an asymmetric Laplace distribution is assumed
for the errors, so the regression models targets the specified quantile.
However, these models are often woefully inadequate for describing
observed data. We introduce a nonparametric transformation to
improve model adequacy while still providing inference for the
regression coefficients and the specified quantile. A g-prior is assumed
for the regression coefficients."><meta property="og:description" content="MCMC sampling for Bayesian quantile regression with an
unknown (nonparametric) transformation. Like in traditional Bayesian
quantile regression, an asymmetric Laplace distribution is assumed
for the errors, so the regression models targets the specified quantile.
However, these models are often woefully inadequate for describing
observed data. We introduce a nonparametric transformation to
improve model adequacy while still providing inference for the
regression coefficients and the specified quantile. A g-prior is assumed
for the regression coefficients."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SeBR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/SeBR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/drkowal/SeBR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Semiparametric Bayesian quantile regression</h1>
      <small class="dont-index">Source: <a href="https://github.com/drkowal/SeBR/blob/master/R/source_sba.R" class="external-link"><code>R/source_sba.R</code></a></small>
      <div class="d-none name"><code>sbqr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>MCMC sampling for Bayesian quantile regression with an
unknown (nonparametric) transformation. Like in traditional Bayesian
quantile regression, an asymmetric Laplace distribution is assumed
for the errors, so the regression models targets the specified quantile.
However, these models are often woefully inadequate for describing
observed data. We introduce a nonparametric transformation to
improve model adequacy while still providing inference for the
regression coefficients and the specified quantile. A g-prior is assumed
for the regression coefficients.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sbqr</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  X_test <span class="op">=</span> <span class="va">X</span>,</span>
<span>  psi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  laplace_approx <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  approx_g <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nsave <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  nburn <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  ngrid <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p><code>n x 1</code> response vector</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>n x p</code> matrix of predictors</p></dd>


<dt id="arg-tau">tau<a class="anchor" aria-label="anchor" href="#arg-tau"></a></dt>
<dd><p>the target quantile (between zero and one)</p></dd>


<dt id="arg-x-test">X_test<a class="anchor" aria-label="anchor" href="#arg-x-test"></a></dt>
<dd><p><code>n_test x p</code> matrix of predictors for test data;
default is the observed covariates <code>X</code></p></dd>


<dt id="arg-psi">psi<a class="anchor" aria-label="anchor" href="#arg-psi"></a></dt>
<dd><p>prior variance (g-prior)</p></dd>


<dt id="arg-laplace-approx">laplace_approx<a class="anchor" aria-label="anchor" href="#arg-laplace-approx"></a></dt>
<dd><p>logical; if TRUE, use a normal approximation
to the posterior in the definition of the transformation;
otherwise the prior is used</p></dd>


<dt id="arg-approx-g">approx_g<a class="anchor" aria-label="anchor" href="#arg-approx-g"></a></dt>
<dd><p>logical; if TRUE, apply large-sample
approximation for the transformation</p></dd>


<dt id="arg-nsave">nsave<a class="anchor" aria-label="anchor" href="#arg-nsave"></a></dt>
<dd><p>number of MCMC iterations to save</p></dd>


<dt id="arg-nburn">nburn<a class="anchor" aria-label="anchor" href="#arg-nburn"></a></dt>
<dd><p>number of MCMC iterations to discard</p></dd>


<dt id="arg-ngrid">ngrid<a class="anchor" aria-label="anchor" href="#arg-ngrid"></a></dt>
<dd><p>number of grid points for inverse approximations</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical; if TRUE, print time remaining</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list with the following elements:</p><ul><li><p><code>coefficients</code> the posterior mean of the regression coefficients</p></li>
<li><p><code>fitted.values</code> the estimated <code>tau</code>th quantile at test points <code>X_test</code></p></li>
<li><p><code>post_theta</code>: <code>nsave x p</code> samples from the posterior distribution
of the regression coefficients</p></li>
<li><p><code>post_ypred</code>: <code>nsave x n_test</code> samples
from the posterior predictive distribution at test points <code>X_test</code></p></li>
<li><p><code>post_qtau</code>: <code>nsave x n_test</code> samples of the <code>tau</code>th conditional quantile at test points <code>X_test</code></p></li>
<li><p><code>post_g</code>: <code>nsave</code> posterior samples of the transformation
evaluated at the unique <code>y</code> values</p></li>
<li><p><code>model</code>: the model fit (here, <code>sbqr</code>)</p></li>
</ul><p>as well as the arguments passed in.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function provides fully Bayesian inference for a
transformed quantile linear model.
The transformation is modeled as unknown and learned jointly
with the regression coefficients (unless <code>approx_g</code> = TRUE, which then uses
a point approximation). This model applies for real-valued data, positive data, and
compactly-supported data (the support is automatically deduced from the observed <code>y</code> values).
The results are typically unchanged whether <code>laplace_approx</code> is TRUE/FALSE;
setting it to TRUE may reduce sensitivity to the prior, while setting it to FALSE
may speed up computations for very large datasets.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Simulate some heteroskedastic data (no transformation):</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="simulate_tlm.html">simulate_tlm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span>, p <span class="op">=</span> <span class="fl">10</span>, g_type <span class="op">=</span> <span class="st">'box-cox'</span>, heterosked <span class="op">=</span> <span class="cn">TRUE</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">y</span>; <span class="va">X</span> <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">X</span> <span class="co"># training data</span></span></span>
<span class="r-in"><span><span class="va">y_test</span> <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">y_test</span>; <span class="va">X_test</span> <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">X_test</span> <span class="co"># testing data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Target this quantile:</span></span></span>
<span class="r-in"><span><span class="va">tau</span> <span class="op">=</span> <span class="fl">0.05</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the semiparametric Bayesian quantile regression model:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu">sbqr</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>, tau <span class="op">=</span> <span class="va">tau</span>, X_test <span class="op">=</span> <span class="va">X_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "27 seconds remaining"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "31 seconds remaining"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "16 seconds remaining"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 seconds remaining"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Total time:  56 seconds"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># what is returned</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "coefficients"  "fitted.values" "post_theta"    "post_ypred"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "post_qtau"     "post_g"        "model"         "y"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "X"             "X_test"        "psi"           "approx_g"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "tau"          </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Posterior predictive checks on testing data: empirical CDF</span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">y_test</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y0</span>, <span class="va">y0</span>, type<span class="op">=</span><span class="st">'n'</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab<span class="op">=</span><span class="st">'y'</span>, ylab<span class="op">=</span><span class="st">'F_y'</span>, main <span class="op">=</span> <span class="st">'Posterior predictive ECDF'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">post_ypred</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">y0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">post_ypred</span><span class="op">[</span><span class="va">s</span>,<span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="va">y0</span><span class="op">)</span>, <span class="co"># ECDF of posterior predictive draws</span></span></span>
<span class="r-in"><span>        col<span class="op">=</span><span class="st">'gray'</span>, type <span class="op">=</span><span class="st">'s'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">y0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">y_test</span><span class="op">)</span><span class="op">(</span><span class="va">y0</span><span class="op">)</span>,  <span class="co"># ECDF of testing data</span></span></span>
<span class="r-in"><span>     col<span class="op">=</span><span class="st">'black'</span>, type <span class="op">=</span> <span class="st">'s'</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sbqr-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan Kowal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

